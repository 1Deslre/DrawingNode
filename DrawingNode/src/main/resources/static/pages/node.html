<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>关系图案例</title>
    <script src="../js/vue.js"></script>
    <script src="../js/echarts.js"></script>
    <script src="../js/axios-0.18.0.js"></script>
    <link rel="stylesheet" href="../css/node.css">
</head>

<body>
<div id="app" class="root">
    <nav class="navbar">
        <ul>
            <li><a href="#">首页</a></li>
            <li><a href="#">关于</a></li>
            <li><a href="#">联系</a></li>
            <li>
                <label>
                    <input type="text" placeholder="输入内容" class="nav-input" v-model="caseNumber">
                </label>
                <button class="nav-button" @click="fetchDataByInput">提交</button>
            </li>
            <li>
                <label>
                    <select v-model="selectedCaseNumber" class="nav-select">
                        <option v-for="caseNum in caseNumbers" :key="caseNum" :value="caseNum">{{ caseNum }}</option>
                    </select>
                </label>
                <button class="nav-button" @click="fetchDataByDropdown">查询</button>
            </li>
            <li>
                <button class="nav-button" @click="fetchChartData">查询</button>
            </li>
        </ul>
    </nav>
    <div id="chart1"></div>
</div>

<script type="text/javascript">
    const vm = new Vue({
        el: '#app',
        data: {
            chartData: null,
            categories: null,
            caseNumber: '',
            caseNumbers: [],
            selectedCaseNumber: ''
        },
        mounted() {
            // Fetch all case numbers on component mount
            this.fetchAllCaseNumbers();
            this.fetchChartData();

            // Listen for window resize event
            window.addEventListener('resize', this.resizeChart);
        },
        methods: {
            fetchChartData() {
                // Example method for fetching chart data using axios
                axios.get('/chart/data')
                    .then(response => {
                        const data = response.data.data;
                        // Adjust chartData, categories, and links as needed
                        this.chartData = data.nodes;
                        this.links = data.links;
                        this.categories = data.categories;
                        this.initChart();
                    })
                    .catch(error => {
                        console.error("Error fetching chart data", error);
                    });
            },
            fetchAllCaseNumbers() {
                // Example method for fetching all case numbers using axios
                axios.get('/operation/allCase')
                    .then(response => {
                        this.caseNumbers = response.data.data;
                    })
                    .catch(error => {
                        console.error("Error fetching case numbers", error);
                    });
            },
            fetchDataByInput() {
                // Example method for fetching data based on input value
                if (!this.caseNumber) {
                    alert('请输入案件号');
                    return;
                }
                axios.get(`/operation/inquire/${this.caseNumber}`)
                    .then(response => {
                        const data = response.data.data;
                        this.chartData = data.nodes;
                        this.links = data.links;
                        this.categories = data.categories;
                        this.initChart();
                    })
                    .catch(error => {
                        console.error("Error fetching data by input", error);
                    });
            },
            fetchDataByDropdown() {
                // Example method for fetching data based on dropdown selection
                if (!this.selectedCaseNumber) {
                    alert('请选择一个案件号');
                    return;
                }
                axios.get(`/operation/inquire/${this.selectedCaseNumber}`)
                    .then(response => {
                        const data = response.data.data;
                        this.chartData = data.nodes;
                        this.links = data.links;
                        this.categories = data.categories;
                        this.initChart();
                    })
                    .catch(error => {
                        console.error("Error fetching data by dropdown", error);
                    });
            },
            initChart() {
                // Example method for initializing ECharts
                if (!this.chartData || !this.categories) return;

                var chart1 = echarts.init(document.getElementById('chart1'));

                var option = {
                    backgroundColor: '#2EA7C2FF',    // 背景颜色
                    title: {
                        text: 'ECharts 关系图',
                        textStyle: { // 标题样式
                            color: '#000', // 标题字体颜色
                            fontSize: '30', // 标题字体大小
                        }
                    },
                    tooltip: {
                        formatter: function (x) {
                            return x.data.des;
                        }
                    },
                    toolbox: {
                        show: true,
                        feature: {
                            mark: {show: true},
                            restore: {show: true},
                            saveAsImage: {show: true}
                        }
                    },
                    legend: [{
                        data: this.categories.map(function (a) {
                            return a.name;
                        })
                    }],
                    series: [{
                        type: 'graph',
                        layout: 'force',
                        symbolSize: 40,
                        focusNodeAdjacency: true,
                        roam: true,
                        force: {
                            repulsion: 2500,
                            edgeLength: [10, 50]
                        },
                        draggable: true,
                        lineStyle: {
                            normal: {
                                width: 2,
                                color: '#4b565b',
                            }
                        },
                        edgeLabel: {
                            normal: {
                                show: true,
                                formatter: function (x) {
                                    return x.data.name;
                                }
                            }
                        },
                        label: {
                            normal: {
                                show: true,
                                textStyle: {}
                            }
                        },
                        data: this.chartData,
                        links: this.links,
                        categories: this.categories,
                    }]
                };

                chart1.setOption(option);
                this.chartInstance = chart1;
            },
            resizeChart() {
                if (this.chartInstance) {
                    this.chartInstance.resize();
                }
            }
        },
        beforeDestroy() {
            // Remove the event listener when component is destroyed
            window.removeEventListener('resize', this.resizeChart);
        }
    });
</script>

</body>

</html>
